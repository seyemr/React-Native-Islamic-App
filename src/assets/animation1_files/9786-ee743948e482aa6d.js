"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9786],{67496:function(e,n,t){t.r(n),t.d(n,{CommentPushover:function(){return de},CommentPushoverMode:function(){return se},default:function(){return ue}});var s=t(97458),l=t(96734),o=t(34723),a=t(37210),r=t(83849),i=t.n(r),c=t(67613),d=t(52983),u=t(75800),m=t(10103),x=t(37091),h=t(17266),v=t(16887);const p=e=>{let{comments:n,iconButton:t=!1,onChange:l}=e;const{pathname:o,push:a,query:r}=(0,c.useRouter)(),i=(0,d.useMemo)((()=>[{label:"All",value:"all"},...n?(0,v.Lt)(n).map((e=>{const n=e.toFixed(0);return{label:"#".concat(n),value:n}})):[]]),[n]),u=(0,d.useCallback)((e=>{null===e.value||r.frame==="".concat(e.value)?delete r.frame:r.frame="".concat(e.value),a({pathname:o,query:r},void 0,{shallow:!0}),null==l||l()}),[o,r,a,l]),p=(0,d.useMemo)((()=>i.find((e=>e.value===r.frame))),[r,i]),f=(0,d.useMemo)((()=>t?(0,s.jsx)(m.h,{name:"filter"}):(0,s.jsxs)("div",{className:"flex items-center h-8 text-gray-600 transition-colors rounded-md hover:bg-gray-50 hover:text-gray-600 font-lf-regular",children:[(0,s.jsx)("div",{children:"Frame-specific"}),(0,s.jsx)(x.J,{name:"chevron-right",color:"text-gray-500",className:"ml-12"})]})),[t]);return(0,s.jsx)(h.ud,{button:f,wrapperCssClasses:t?"absolute right-0":"absolute left-5",placement:t?"right-end":"right-start",options:i,onChange:u,selection:p,width:"w-24",staticButton:!0,selectionSide:h.pf.LEFT})},f=e=>{let{comments:n}=e;const{pathname:t,push:l,query:o}=(0,c.useRouter)(),a=(0,d.useRef)(null),[r,i]=(0,d.useState)([]),[u,m]=(0,d.useState)(),x=(0,d.useCallback)((()=>{var e;null===(e=a.current)||void 0===e||e.close()}),[]),v=(0,d.useMemo)((()=>[{label:"All",value:"all"},{label:"Frame-specific",value:"frame-specific",element:(0,s.jsx)(p,{comments:n,onChange:x},1)},{label:"Non-frame-specific",value:"non-frame-specific"},{label:"Show resolved",value:"hide-resolved",multiSelect:!0}]),[n,x]),f=(0,d.useCallback)(((e,n)=>{"all"===e.value?delete o.frame:"non-frame-specific"===e.value&&(o.frame="none"),"hide-resolved"===e.value&&(n?delete o["hide-resolved"]:o["hide-resolved"]="true"),l({pathname:t,query:o},void 0,{shallow:!0})}),[o,t,l]);return(0,d.useEffect)((()=>{o.frame?"none"===o.frame?m(v.find((e=>"non-frame-specific"===e.value))):m(v.find((e=>"frame-specific"===e.value))):m(v.find((e=>"all"===e.value))),"true"===o["hide-resolved"]?i((e=>(e.splice(0),e))):i((e=>(e.push(v.find((e=>"hide-resolved"===e.value))),e)))}),[o,m,i]),(0,s.jsx)(h.ud,{ref:a,wrapperCssClasses:"absolute right-0",placement:"bottom-end",options:v,onChange:f,onMultiselectChange:f,multiSelection:r,selection:u,width:"w-56",selectionSide:h.pf.LEFT})},C=e=>{let{comments:n}=e;const{pathname:t,push:l,query:o}=(0,c.useRouter)(),a=(0,d.useCallback)((()=>{"frame"in o&&delete o.frame,l({pathname:t,query:o},void 0,{shallow:!0})}),[t,o,l]);return(0,s.jsx)("div",{className:"px-6 py-2",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(f,{comments:n}),(0,s.jsx)("div",{className:"flex-grow"}),"frame"in o&&(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex items-center h-6 px-2 text-xs text-teal-800 bg-teal-200 rounded-md",children:[(0,s.jsxs)("span",{className:"mr-2",children:["#",o.frame]}),(0,s.jsx)("button",{type:"button",className:"text-teal-700",onClick:a,children:(0,s.jsx)(x.J,{name:"cross",className:"h-2.5 w-2.5"})})]})}),"frame"in o&&(0,s.jsx)(p,{comments:n,iconButton:!0})]})})};var b=t(90361),y=t(66001),j=t(16153),g=t(33553),k=t(58956),w=t(58535),N=t(59598),I=t(40207),R=t(99808);const M=e=>{let{isExpanded:n,mentionables:t,onCollapse:l,onExpand:o,onPost:a}=e;const[r,c]=(0,d.useState)(!1),{currentFrame:m}=(0,R.F)(),x=(0,d.useRef)(null),h=(0,u.useRecoilValue)(N.h3),{nextStep:v}=(0,w.d)();(0,k.Z)(x,(()=>{l(),c(!1)}));const p=(0,d.useCallback)((e=>{c(e)}),[]),f=(0,d.useCallback)((()=>{l(),c(!1)}),[l]),C=(0,d.useCallback)((e=>{v({taskId:I.X.COMMENT_ON_FRAME,currentStep:1}),a(e),f()}),[f,a,v]);return h?null:(0,s.jsx)("div",{className:"flex px-6",ref:x,children:(0,s.jsx)("div",{className:i()({"flex relative w-full bg-gray-50 rounded-md border":!0,"px-4 py-2 border-gray-200 shadow":!n,"p-2 border-teal-200":n}),children:(0,s.jsx)(y.Q,{className:"flex relative w-full",taskId:I.X.COMMENT_ON_FRAME,sideOffset:22,step:1,side:"left",children:n?(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex flex-col items-start space-y-2 w-full",children:[(0,s.jsx)(g.X,{label:"",valueLabel:"Frame-specific",onChange:p,labelClass:"text-xs",checked:r}),(0,s.jsx)("div",{className:"w-full",children:r?(0,s.jsx)(b._,{loginToMention:!0,postButtonText:"Post",placeholder:"Add a comment. Use @ to mention.",borderless:!0,frame:m,mentionables:t,onCancel:f,onPost:C,rows:3}):(0,s.jsx)(b._,{loginToMention:!0,postButtonText:"Post",placeholder:"Add a comment. Use @ to mention.",mentionables:t,borderless:!0,onCancel:f,onPost:C,rows:3})})]})}):(0,s.jsx)("div",{className:"py-2",onClick:o,role:"presentation",children:(0,s.jsx)(j.Z,{children:"Add a comment. Use @ to mention."})})})})})},S=()=>(0,s.jsxs)("div",{className:"p-6 space-y-4",children:[(0,s.jsx)("h4",{className:"text-gray-900 text-md font-lf-bold",children:"Add comments in 3 ways"}),(0,s.jsxs)("div",{className:"flex items-start text-sm font-light text-gray-600",children:[(0,s.jsxs)("svg",{className:"w-12 h-10 mr-4",viewBox:"0 0 28 27",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M24.2822 19.289L12.6388 8.03903C12.6387 7.9466 12.6149 7.85564 12.5697 7.77418C12.5245 7.69273 12.4592 7.62329 12.3796 7.57202C12.3 7.52074 12.2086 7.48921 12.1133 7.48021C12.0181 7.47121 11.9221 7.48502 11.8337 7.52041C11.7454 7.55581 11.6674 7.6117 11.6067 7.68314C11.546 7.75458 11.5044 7.83938 11.4857 7.93002C11.467 8.02067 11.4717 8.11437 11.4994 8.20285C11.5271 8.29132 11.5769 8.37184 11.6445 8.43728V24.014C11.644 24.1197 11.6744 24.2233 11.7321 24.313C11.7898 24.4026 11.8726 24.4748 11.9708 24.5211C12.0691 24.5674 12.1789 24.5859 12.2876 24.5747C12.3962 24.5634 12.4994 24.5227 12.5853 24.4573L15.5415 22.223L18.1217 26.7095C18.195 26.8358 18.3157 26.9302 18.4589 26.9731C18.6021 27.016 18.7568 27.0042 18.8913 26.9402L22.3843 25.2527C22.4547 25.2188 22.5172 25.1715 22.568 25.1136C22.6189 25.0557 22.6571 24.9884 22.6803 24.9158C22.7035 24.8433 22.7112 24.7669 22.7029 24.6914C22.6947 24.6158 22.6707 24.5427 22.6323 24.4764L20.2023 20.2498H23.87C23.9853 20.25 24.0981 20.2171 24.194 20.1553C24.2899 20.0935 24.3647 20.0056 24.4088 19.9027C24.453 19.7998 24.4645 19.6865 24.442 19.5773C24.4194 19.468 24.3638 19.3677 24.2822 19.289Z",fill:"currentColor"}),(0,s.jsx)("path",{d:"M9.14242 15.1142C7.31122 14.3218 5.88005 12.86 5.1628 11.0494C4.44556 9.23887 4.5008 7.22736 5.31641 5.45609C7.01867 1.77509 11.5037 0.119086 15.3122 1.75934C17.1434 2.55174 18.5746 4.01354 19.2918 5.82411C20.0091 7.63468 19.9538 9.64619 19.1382 11.4175C19.0754 11.5537 19.0711 11.7084 19.1264 11.8477C19.1816 11.9869 19.2918 12.0992 19.4328 12.16C19.5738 12.2207 19.7339 12.2248 19.8781 12.1714C20.0222 12.118 20.1384 12.0115 20.2013 11.8753C20.6716 10.8643 20.9298 9.7733 20.961 8.66528C20.9922 7.55727 20.7957 6.45427 20.3829 5.42009C19.9758 4.38368 19.3599 3.43565 18.5708 2.63094C17.7818 1.82623 16.8352 1.18086 15.7861 0.732211C11.3919 -1.16341 6.21644 0.749086 4.25337 4.99821C3.7833 6.00927 3.52523 7.1003 3.49405 8.20828C3.46288 9.31625 3.65922 10.4192 4.07173 11.4535C4.4788 12.4899 5.09473 13.4379 5.8838 14.2426C6.67287 15.0473 7.6194 15.6927 8.66853 16.1413C8.80865 16.1972 8.9658 16.1981 9.10656 16.1437C9.24733 16.0894 9.36061 15.9842 9.42233 15.8504C9.48405 15.7166 9.48933 15.5649 9.43706 15.4274C9.38479 15.2899 9.27908 15.1776 9.14242 15.1142Z",fill:"currentColor"}),(0,s.jsx)("path",{d:"M10.5093 12.0073C10.0232 11.7905 9.58642 11.4827 9.22428 11.1017C8.86213 10.7207 8.5818 10.274 8.39951 9.78764C8.21448 9.30229 8.13093 8.7863 8.15372 8.26954C8.1765 7.75278 8.30516 7.24553 8.53224 6.77714C8.75646 6.30736 9.07498 5.88527 9.46932 5.53534C9.86366 5.18541 10.326 4.91461 10.8295 4.73864C11.3318 4.56011 11.8658 4.47952 12.4006 4.50153C12.9354 4.52355 13.4604 4.64772 13.9452 4.86689C14.4314 5.08354 14.8683 5.39129 15.2305 5.77232C15.5926 6.15334 15.8729 6.60004 16.055 7.08652C16.4288 8.07427 16.381 9.14414 15.9223 10.097C15.864 10.2314 15.8618 10.3825 15.9163 10.5184C15.9707 10.6544 16.0776 10.7646 16.2144 10.826C16.3512 10.8875 16.5073 10.8953 16.65 10.8479C16.7926 10.8005 16.9107 10.7015 16.9795 10.5718C17.2716 9.96949 17.437 9.31718 17.4661 8.65267C17.4953 7.98816 17.3877 7.32466 17.1495 6.70064C16.9149 6.0753 16.5544 5.50109 16.0887 5.0112C15.6231 4.52131 15.0615 4.12545 14.4366 3.84652C13.8132 3.56451 13.1381 3.40478 12.4504 3.37659C11.7627 3.3484 11.076 3.45229 10.4301 3.68227C9.7829 3.90892 9.18862 4.25728 8.6816 4.7072C8.17457 5.15712 7.76488 5.69968 7.47619 6.30352C7.18413 6.9058 7.01872 7.5581 6.98954 8.22261C6.96036 8.88713 7.06799 9.55062 7.30619 10.1746C7.54078 10.8 7.90132 11.3742 8.36697 11.8641C8.83262 12.354 9.39415 12.7498 10.0191 13.0288C10.1579 13.0833 10.3132 13.0842 10.4526 13.0311C10.5921 12.978 10.705 12.8751 10.7681 12.7438C10.8311 12.6124 10.8394 12.4626 10.7912 12.3255C10.743 12.1883 10.6421 12.0744 10.5093 12.0073Z",fill:"currentColor"})]}),(0,s.jsx)("p",{children:"Click on an animation to add an annotated comment thatâ€™s specific to a frame."})]}),(0,s.jsxs)("div",{className:"flex items-start text-sm font-light text-gray-600",children:[(0,s.jsx)("svg",{className:"w-12 h-10 mr-4",viewBox:"0 0 20 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M8.5554 0.335026C13.0204 0.335026 16.6402 3.16494 16.6402 6.65624C16.6402 10.1475 13.0204 12.9775 8.5554 12.9775C8.13408 12.9778 7.71317 12.952 7.29525 12.9004C5.55863 14.5721 3.55359 14.871 1.54856 14.9158V14.5065C2.63085 13.9961 3.50293 13.067 3.50293 12.0046C3.50293 11.8567 3.49107 11.7109 3.46843 11.5682C1.64019 10.409 0.470581 8.63937 0.470581 6.6552C0.470581 3.1639 4.09043 0.333984 8.5554 0.333984V0.335026ZM17.2471 14.5044C17.2471 15.4147 17.8583 16.2115 18.7973 16.649V17C17.0606 16.9625 15.4663 16.7052 13.9604 15.2731C13.6046 15.3158 13.2392 15.3387 12.8684 15.3387C11.26 15.3387 9.77891 14.92 8.59637 14.2148C11.0337 14.2065 13.3341 13.4524 15.0782 12.088C15.9286 11.434 16.6306 10.6178 17.1404 9.6903C17.7356 8.60321 17.9988 7.37507 17.8993 6.149C19.1217 7.1239 19.8742 8.45397 19.8742 9.91944C19.8742 11.6203 18.8609 13.1368 17.2762 14.1305C17.2567 14.2542 17.247 14.3792 17.2471 14.5044Z",fill:"currentColor"})}),(0,s.jsx)("p",{children:"Click the comment button next to the timeline to add a comment on a specific frame."})]}),(0,s.jsxs)("div",{className:"flex items-start text-sm font-light text-gray-600",children:[(0,s.jsx)("svg",{className:"w-6 h-6 mr-4",viewBox:"0 0 25 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M13.5594 22H7.34965C5.59021 22 4.24475 20.7 4.24475 19V5C4.24475 3.3 5.59021 2 7.34965 2H13.5594V4H7.34965C6.72867 4 6.31468 4.4 6.31468 5V19C6.31468 19.6 6.72867 20 7.34965 20H13.5594V22ZM19.7692 7H20.8042V5H19.7692C18.9413 5 18.2168 5.3 17.6993 5.8C17.1818 5.3 16.4573 5 15.6294 5H14.5944V7H15.6294C16.1468 7 16.6643 7.5 16.6643 8V16C16.6643 16.5 16.1468 17 15.6294 17H14.5944V19H15.6294C16.4573 19 17.1818 18.7 17.6993 18.2C18.2168 18.7 18.9413 19 19.7692 19H20.8042V17H19.7692C19.2517 17 18.7343 16.5 18.7343 16V8C18.7343 7.5 19.2517 7 19.7692 7Z",fill:"currentColor"})}),(0,s.jsx)("p",{children:"Enter your comment in the text box above."})]})]});var E=t(70444),A=t(1502),F=t(82690),D=t(15779),U=t(74675),T=t(23494),L=t(68589),P=t(23048),V=t(49146);const B=e=>{let{comment:n,currentUserId:t,mentionables:l,onDelete:o,onEdit:a,onReply:r,onResolve:i,onSelectReaction:c,onUnresolve:m}=e;var h,v,p,f,C;const[b,y]=(0,d.useState)(!1),[g,k]=(0,d.useState)(!1),[w,I]=(0,d.useState)(!1),R=(0,d.useRef)(null),M=(0,u.useRecoilValue)(N.h3),S=(0,d.useCallback)((()=>{y(!0)}),[]),B=(0,d.useCallback)((()=>{y(!1)}),[]),O=(0,d.useCallback)((()=>{k(!1)}),[]),_=(0,d.useCallback)(((e,n)=>{a(e,n),k(!1)}),[a]),Z=(0,d.useCallback)((e=>{r(n),e.stopPropagation()}),[r,n]),q=(0,d.useCallback)((()=>{k(!0)}),[]),G=(0,d.useCallback)((()=>{I(!0)}),[]),H=(0,d.useCallback)((()=>{I(!1)}),[]),J=(0,d.useCallback)((e=>{I(!1),o(e)}),[o]),z=(0,d.useCallback)(((e,t)=>{c(n.id,e,t)}),[n,c]);var K,X;return(0,s.jsx)("div",{className:"px-6 py-1",children:g?(0,s.jsx)("div",{className:"rounded-md bg-gray-50 hover:bg-gray-100",children:(0,s.jsx)(F.z,{comment:n,mentionables:l,onCancel:O,onEdit:_})}):(0,s.jsxs)("div",{ref:R,className:"relative flex flex-col px-4 py-2 rounded-md bg-gray-50 hover:bg-gray-100",onMouseEnter:S,onMouseLeave:B,onClick:Z,role:"presentation",children:[(n.nodeId||n.resolvedAt)&&(0,s.jsxs)("div",{className:"flex",children:[n.nodeId&&(0,s.jsx)(j.Z,{variant:"caption-1",color:"gray",children:n.nodeId}),n.resolvedAt&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex-grow"}),(0,s.jsx)(P.u,{title:(0,V.h5)(n.resolvedAt).toLocaleString(),children:(0,s.jsx)(x.J,{name:"tick",color:"text-green-500"})})]})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(E.a,{src:null===(h=n.user)||void 0===h?void 0:h.avatarUrl,name:null!==(X=null!==(K=null===(v=n.user)||void 0===v?void 0:v.name)&&void 0!==K?K:n.guestName)&&void 0!==X?X:"Anonymous",createdAt:new Date(n.createdAt)}),(0,s.jsx)("div",{className:"flex-grow"}),t&&!M&&(0,s.jsx)("div",{className:"flex-shrink-0",children:b&&(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)(L.j,{commentId:n.id,onSelect:c,hoverBackgroundClassName:"hover:bg-gray-100"}),R.current&&(0,s.jsx)(D.j,{currentUserId:t,userId:null===(p=n.user)||void 0===p?void 0:p.id,commentId:n.id,isResolved:Boolean(n.resolvedAt),container:R.current,onDeleteClick:G,onEditClick:q,onResolve:i,onUnresolve:m})]})})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(U._,{body:n.body,frame:null===(f=n.extra)||void 0===f?void 0:f.frame,mentions:n.mentions}),(0,s.jsxs)("div",{className:"flex items-center mt-2",children:["number"==typeof n.replyCount&&n.replyCount>0&&(0,s.jsxs)("div",{className:"flex items-center text-gray-400 text-cs",children:[(0,s.jsx)(x.J,{name:"comment"}),(0,s.jsx)("p",{children:n.replyCount})]}),!n.resolvedAt&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex-grow"}),(0,s.jsx)("button",{type:"button",className:"text-xs text-gray-400 hover:text-teal-600 focus:outline-none",onClick:Z,children:M?"Replies":"Reply"})]})]}),Boolean(null===(C=n.reactions)||void 0===C?void 0:C.length)&&(0,s.jsx)("div",{className:"relative mt-2",children:(0,s.jsx)(T.U,{reactions:n.reactions,currentUserId:t,onReactionClick:z})})]}),w&&(0,s.jsx)("div",{className:"absolute top-0 left-0 w-full h-full bg-white border border-gray-200 rounded-md bg-opacity-95",children:(0,s.jsx)(A.F,{comment:n,onDelete:J,onCancel:H})})]})})};var O=t(52364);const _=e=>{let{canFetchMoreComments:n,currentUserId:t,discussions:l,isFetchingComments:o,mentionables:a,onDelete:r,onEdit:i,onFetchMoreComments:c,onReplyClick:d,onResolve:u,onSelectReaction:m,onUnresolve:x}=e;const h=(0,O.S)({onIntersecting:c});return l.length?(0,s.jsxs)(s.Fragment,{children:[l.map((e=>(0,s.jsx)(B,{mentionables:a,currentUserId:t,comment:e.node,onDelete:r,onEdit:i,onResolve:u,onSelectReaction:m,onUnresolve:x,onReply:d},e.node.id))),n&&!o&&(0,s.jsx)("span",{ref:h})]}):null};var Z=t(84952);const q=e=>{let{canFetchMoreComments:n,currentUserId:t,discussions:l,isFetching:o,isInputExpanded:a,mentionables:r,onCollapseInput:i,onDelete:m,onEdit:x,onExpandInput:h,onFetchMoreComments:v,onPost:p,onReplyClick:f,onResolve:b,onSelectReaction:y,onUnresolve:j}=e;const{query:g}=(0,c.useRouter)(),k=(0,u.useRecoilValue)(N.h3),w=(0,d.useMemo)((()=>{if(!l)return[];let e=[];e="none"===g.frame?l.filter((e=>{let{node:n}=e;var t;return void 0===(null===(t=n.extra)||void 0===t?void 0:t.frame)})):"all"===g.frame?l.filter((e=>{let{node:n}=e;var t;return"number"==typeof(null===(t=n.extra)||void 0===t?void 0:t.frame)})):void 0!==g.frame&&g.frame?l.filter((e=>{let{node:n}=e;var t;return"".concat(null===(t=n.extra)||void 0===t?void 0:t.frame)==="".concat(g.frame)})):l;let n=e;return"true"===g["hide-resolved"]&&(n=e.filter((e=>{let{node:n}=e;return!n.resolvedAt}))),n.sort(((e,n)=>{let{node:t}=e,{node:s}=n;return new Date(s.createdAt).getTime()-new Date(t.createdAt).getTime()}))}),[l,g]),I=(0,d.useCallback)((e=>{p(e)}),[p]);return!k||l&&l.length?k||l&&l.length||!o?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M,{mentionables:r,onPost:I,onCollapse:i,onExpand:h,isExpanded:a}),(0,s.jsx)(C,{comments:l}),l&&l.length?(0,s.jsx)(_,{currentUserId:t,discussions:w,mentionables:r,canFetchMoreComments:n,isFetchingComments:o,onDelete:m,onEdit:x,onReplyClick:f,onResolve:b,onSelectReaction:y,onUnresolve:j,onFetchMoreComments:v}):(0,s.jsx)(S,{})]}):(0,s.jsx)(Z.a,{}):(0,s.jsx)("div",{className:"px-5 mt-4 text-sm text-gray-900",children:"No comments."})},G=e=>{let{comment:n,currentUserId:t,onDelete:l,onEdit:o,onResolve:a,onSelectReaction:r,onUnresolve:i}=e;var c,m,h,v,p,f;const C=null!==(f=null!==(p=null===(c=n.user)||void 0===c?void 0:c.name)&&void 0!==p?p:n.guestName)&&void 0!==f?f:"Anonymous",b=(0,d.useRef)(null),[y,j]=d.useState(!1),[g,k]=d.useState(!1),[w,I]=d.useState(!1),R=(0,u.useRecoilValue)(N.h3),M=(0,d.useCallback)((()=>{j(!0)}),[]),S=(0,d.useCallback)((()=>{j(!1)}),[]),B=(0,d.useCallback)((()=>{k(!0)}),[]),O=(0,d.useCallback)((()=>{I(!0)}),[]),_=(0,d.useCallback)((e=>{l(e),I(!1)}),[l]),Z=(0,d.useCallback)((()=>{I(!1)}),[]),q=(0,d.useCallback)(((e,t)=>{r(n.id,e,t)}),[r,n.id]),G=(0,d.useCallback)(((e,n)=>{o(e,n),k(!1)}),[o]),H=(0,d.useCallback)((()=>{k(!1)}),[]);return g?(0,s.jsx)("div",{className:"px-2 py-1",children:(0,s.jsx)(F.z,{comment:n,onCancel:H,onEdit:G})}):(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"flex flex-col border-b-[1px] border-gray-200 py-4",ref:b,onMouseEnter:M,onMouseLeave:S,children:[(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)(E.a,{src:null===(m=n.user)||void 0===m?void 0:m.avatarUrl,name:C,createdAt:new Date(n.createdAt)}),(0,s.jsx)("div",{className:"flex-grow"}),t&&!R&&(0,s.jsx)("div",{className:"flex-shrink-0",children:y&&(0,s.jsxs)("div",{className:"flex flex-row",children:[(0,s.jsx)(L.j,{commentId:n.id,onSelect:r}),b.current&&(0,s.jsx)(D.j,{currentUserId:t,userId:null===(h=n.user)||void 0===h?void 0:h.id,commentId:n.id,isResolved:Boolean(n.resolvedAt),container:b.current,onDeleteClick:O,onEditClick:B,onResolve:a,onUnresolve:i})]})}),n.resolvedAt&&(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(P.u,{title:(0,V.h5)(n.resolvedAt).toLocaleString(),children:(0,s.jsx)(x.J,{name:"tick",color:"text-green-500"})})})]}),(0,s.jsx)("div",{className:"text-sm",children:(0,s.jsx)(U._,{body:n.body,frame:null===(v=n.extra)||void 0===v?void 0:v.frame,mentions:n.mentions})}),Boolean(n.reactions)&&(0,s.jsx)("div",{className:"relative mt-2",children:(0,s.jsx)(T.U,{reactions:n.reactions,currentUserId:t,onReactionClick:q})}),w&&(0,s.jsx)("div",{className:"absolute top-0 left-0 w-full h-full bg-white border border-gray-200 rounded-md bg-opacity-95",children:(0,s.jsx)(A.F,{comment:n,onDelete:_,onCancel:Z})})]})})};var H=t(25939);const J=e=>{let{currentUserId:n,onDelete:t,onEdit:l,onResolve:o,onSelectReaction:a,onUnresolve:r,parentCommentId:i}=e;var c;const{canFetchMoreReplies:d,onFetchMoreReplies:u,repliesQuery:m}=(0,H.J)({parentCommentId:i}),x=(0,O.S)({onIntersecting:u});return!m.data&&m.fetching?(0,s.jsx)(Z.a,{size:"xs",type:"spinner"}):(0,s.jsxs)("div",{className:"pl-8",children:[null===(c=m.data)||void 0===c?void 0:c.commentReplies.edges.map((e=>(0,s.jsx)(G,{currentUserId:n,comment:e.node,onDelete:t,onEdit:l,onResolve:o,onSelectReaction:a,onUnresolve:r},e.node.id))),d&&!m.fetching&&(0,s.jsx)("span",{ref:x})]})};var z=t(75420),K=t(71800);const X=e=>{let{loginToMention:n,mentionables:t,onReply:l}=e;const o=(0,u.useRecoilValue)(N.h3),a=(0,d.useRef)(null),r=(0,d.useRef)(null),[c,m]=(0,d.useState)(!1),[x,h]=(0,d.useState)("");(0,k.Z)(a,(()=>{m(!1)}));const v=(0,d.useCallback)((e=>{r.current&&(l(x),r.current.value=""),e.stopPropagation(),h("")}),[l,x]),p=(0,d.useCallback)(((e,n)=>{h(n)}),[]);return o?null:(0,s.jsx)("div",{className:"flex",ref:a,children:(0,s.jsx)("div",{className:i()("p-2 min-h-[9rem] flex w-full border bg-gray-50 rounded-md",{"border-gray-100":!c,"border-teal-200":c}),children:(0,s.jsxs)("div",{className:"relative flex flex-col w-full",children:[(0,s.jsx)("div",{className:"flex w-full p-2 m-2",children:(0,s.jsx)(z.T,{loginToMention:n,inputRef:r,"aria-label":"Reply",placeholder:"Add a reply. Use @ to mention.",rows:3,users:t,markup:x,onChange:p,onFocus:()=>m(!0)})}),(0,s.jsx)("div",{className:"flex-grow"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-grow"}),(0,s.jsx)("div",{className:"flex",children:(0,s.jsx)(K.z,{text:"Reply",onClick:v,disabled:Boolean(!c)})})]})]})})})};var Q=t(64076);const W=e=>{let{currentUserId:n,mentionables:t,onDelete:l,onEdit:o,onPostReply:a,onResolve:r,onSelectReaction:c,onUnresolve:u,parentComment:m}=e;const x=(0,d.useCallback)((e=>{a(m.id,e)}),[a,m.id]),h=(0,Q.C)();return(0,s.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,s.jsxs)("div",{className:"flex flex-col flex-1 h-full overflow-auto",children:[(0,s.jsx)("div",{className:"px-6",children:(0,s.jsx)(G,{currentUserId:n,comment:m,onDelete:l,onEdit:o,onResolve:r,onUnresolve:u,onSelectReaction:c})}),(0,s.jsx)("div",{className:"px-6",children:(0,s.jsx)(J,{currentUserId:n,parentCommentId:m.id,onDelete:l,onEdit:o,onResolve:r,onSelectReaction:c,onUnresolve:u})})]}),(0,s.jsx)("div",{className:i()("px-6 mt-2 ",{"mb-24":h,"mb-10":!h}),children:(0,s.jsx)(X,{loginToMention:!0,mentionables:t,onReply:x})})]})};var Y=t(88360),$=t(63730),ee=t(66898);const ne=e=>{let{onClose:n}=e;const{connectSlack:t}=(0,ee.U)(),l=(0,d.useCallback)((async()=>{n(),t(Y.PO.COMMENT_ONBOARDING)}),[t,n]);return(0,s.jsx)("div",{className:"absolute bottom-0 right-0 p-3",children:(0,s.jsxs)("div",{className:"border border-gray-100 rounded-md shadow-md w-[380px] bg-white",children:[(0,s.jsxs)("div",{className:"py-4 px-5 border-b border-gray-100 flex items-center",children:[(0,s.jsx)("p",{className:"font-lf-semi-bold flex-1",children:"Get notified on Slack about replies"}),(0,s.jsx)("button",{type:"button",className:"flex w-5 h-5 ml-auto flex-shrink-0",onClick:n,children:(0,s.jsx)(x.J,{name:"cross",className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"p-5",children:[(0,s.jsx)("img",{src:"https://stp-v4-cdn.lottiefiles.com/Visual_1_4ea95f8565.png",className:"w-[348px]",alt:""}),(0,s.jsx)("p",{className:"text-sm text-[#4C5863] mt-3",children:"Connect to Slack to get all your workspaces' notifications on Slack."})]}),(0,s.jsxs)("div",{className:"border-t border-gray-100 py-4 px-5 flex justify-end items-center space-x-2",children:[(0,s.jsx)("button",{type:"button",className:"px-3 py-1 text-[#20272C] font-lf-semi-bold text-sm",onClick:n,children:"Not now"}),(0,s.jsx)("button",{type:"button",className:"px-3 py-1 bg-[#00C1A2] text-white font-lf-semi-bold text-sm rounded-md",onClick:l,children:"Add to Slack"})]})]})})},te=e=>{let{onClose:n}=e;return(0,$.createPortal)((0,s.jsx)(ne,{onClose:n}),document.body)};var se,le=t(71874),oe=t(2242),ae=t(63767),re=t(30494);!function(e){e.DiscussionMode="discussion",e.ReplyMode="reply"}(se||(se={}));const ie=(0,a.zo)("div",{display:"flex",flexDirection:"column",alignItems:"center",overflow:"hidden",transition:"all 0.2s ease-in-out"}),ce=(0,a.zo)("div",{display:"flex",flexDirection:"column",alignItems:"center"}),de=e=>{let{canFetchMoreComments:n,currentUserId:t,discussions:a,isFetchingDiscussions:r,isInputExpanded:u,mentionables:m,mode:h,onCollapseInput:v,onDelete:p,onEdit:f,onExpandInput:C,onFetchMoreComments:b,onPost:y,onReply:j,onReplyClick:g,onResolve:k,onSelectReaction:w,onUnresolve:N,parentDiscussion:I}=e;const R=(0,d.useRef)(null),[M,E]=(0,d.useState)(!1),A=(0,d.useCallback)((()=>{E((e=>!e))}),[]),F=(0,l.SS)(o.AD.ENABLE_SLACK_INTEGRATION),{canShowOnboarding:D,updateOnboardingStatus:U}=(0,ae.k)(),T=(0,d.useCallback)((()=>E(!1)),[]),[L,P]=(0,d.useState)(!1),{user:V}=(0,oe.a)(),B=null==V?void 0:V.hasSlackNotificationEnabled,O=(0,c.useRouter)();(0,d.useEffect)((()=>{const e=()=>{L&&(P(!1),U({[re.yM.SLACK_ONBOARDING_FOR_COMMENT]:!0}))};return O.events.on("routeChangeComplete",e),()=>{O.events.off("routeChangeComplete",e)}}),[O.events,L,U]);const _=(0,d.useCallback)((()=>{!B&&F.on&&D(re.yM.SLACK_ONBOARDING_FOR_COMMENT)&&(U({[re.yM.SLACK_ONBOARDING_FOR_COMMENT]:!0}),P(!0))}),[B,F.on,D,U]),Z=(0,d.useCallback)((e=>{y(e),_()}),[_,y]),G=(0,d.useCallback)(((e,n)=>{j(e,n),_()}),[_,j]),H=(0,d.useCallback)((()=>{P(!1)}),[]),J=(0,d.useCallback)((e=>{g(e)}),[g]),z=(0,d.useCallback)((()=>{g(null)}),[g]);return(0,s.jsxs)("div",{className:"flex flex-col flex-grow h-full overflow-hidden",children:["discussion"===h?(0,s.jsxs)("div",{className:"flex items-center py-6",children:[(0,s.jsx)("h3",{className:"pl-6 pr-2 text-base text-gray-900 font-lf-bold",children:"Comments"}),a&&a.length>0&&(0,s.jsxs)(ie,{children:[(0,s.jsx)(ce,{ref:R,onMouseEnter:A,onMouseLeave:A,children:(0,s.jsx)(x.J,{name:"info",small:!0})}),M&&(0,s.jsx)(le.J,{show:!0,offsetX:-10,offsetY:20,placement:"bottom",onClose:T,triggerElementRef:R,content:(0,s.jsx)(S,{})})]})]}):(0,s.jsx)("div",{className:"relative w-full bg-white",children:(0,s.jsx)("div",{className:"flex items-center p-6 text-gray-600",children:(0,s.jsxs)("button",{className:"flex items-center",type:"button","data-testid":"close-button",onClick:z,children:[(0,s.jsxs)("svg",{className:"w-4 h-4 mr-4",viewBox:"0 0 17 14",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("path",{d:"M7 1L1 7L7 13",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M1 7L16 7",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,s.jsx)("h3",{className:"text-xl font-lf-bold",children:"Replies"})]})})}),(0,s.jsxs)("div",{className:i()("flex-1 h-[80vh] overflow-auto",{}),children:["discussion"===h&&(0,s.jsx)(q,{canFetchMoreComments:n,currentUserId:t,discussions:a,isFetching:r,isInputExpanded:u,mentionables:m,onCollapseInput:v,onDelete:p,onEdit:f,onExpandInput:C,onPost:Z,onReplyClick:J,onResolve:k,onSelectReaction:w,onFetchMoreComments:b,onUnresolve:N}),"reply"===h&&I&&(0,s.jsx)(W,{currentUserId:t,mentionables:m,parentComment:I,onDelete:p,onEdit:f,onResolve:k,onUnresolve:N,onPostReply:G,onSelectReaction:w})]}),L&&F.on&&(0,s.jsx)(te,{onClose:H})]})};var ue=de},26507:function(e,n,t){t.d(n,{L:function(){return x}});var s=t(97458),l=t(83849),o=t.n(l),a=t(52983),r=t(75800),i=t(59598),c=t(10103),d=t(23048),u=t(22455),m=t(4876);const x=e=>{let{className:n="",horizontalLayout:t=!1,hoverBackgroundColorClass:l,hoverIconColorClass:x,placement:h="left",rounded:v=!0,shadow:p=!0}=e;const[f,C]=(0,r.useRecoilState)(i.EG),b=.25,y=(0,a.useCallback)((()=>{C((e=>e+b))}),[C]),j=(0,a.useCallback)((()=>{f>b&&C(f-b)}),[f,C]),g=(0,a.useCallback)((()=>{C(1)}),[C]),k=(0,a.useMemo)((()=>(0,s.jsx)(u.z,{keys:["+"],metaKey:!0})),[]),w=(0,a.useMemo)((()=>(0,s.jsx)(u.z,{keys:["-"],metaKey:!0})),[]),N=(0,a.useMemo)((()=>(0,s.jsx)(u.z,{keys:["0"],metaKey:!0})),[]);return(0,m.Z)({key:"+",action:y,dependencies:[f],metaKeyRequired:!0,takesPrecedence:!0}),(0,m.Z)({key:"-",action:j,dependencies:[f],metaKeyRequired:!0,takesPrecedence:!0}),(0,m.Z)({key:"0",action:g,dependencies:[f],metaKeyRequired:!0,takesPrecedence:!0}),(0,s.jsxs)("div",{className:o()("flex  bg-white",{"flex-col divide-y border-gray-100":!t,"items-center":t,"rounded-lg":v,"shadow-sm":p,"space-x-1":t},n),children:[(0,s.jsx)(d.u,{title:"Zoom in",placement:h,shortcut:k,children:(0,s.jsx)(c.h,{name:"plus",onClick:y,darker:!0,rounded:!0,backgroundColor:"white",hoverBackgroundClass:l||"hover:bg-gray-100",hoverIconClass:o()(x||"hover:text-teal-500","!size-8 !rounded-t-lg !rounded-b-none"),noFocus:!0})}),(0,s.jsx)(d.u,{title:"Reset zoom",placement:h,shortcut:N,children:(0,s.jsxs)("div",{className:"flex items-center justify-center flex-shrink-0 h-12 text-gray-900 bg-white font-lf-semi-bold",style:{fontSize:"8px"},onClick:g,onKeyDown:()=>{},children:[100*f,"%"]})}),(0,s.jsx)(d.u,{title:"Zoom out",placement:h,shortcut:w,children:(0,s.jsx)(c.h,{name:"minus",onClick:j,darker:!0,rounded:!0,backgroundColor:"white",hoverBackgroundClass:o()(l||"hover:bg-gray-100","!size-8 !rounded-t-none !rounded-b-lg"),hoverIconClass:x||"hover:text-teal-500",noFocus:!0})})]})}},17266:function(e,n,t){t.d(n,{jV:function(){return h},pf:function(){return s},ud:function(){return v}});var s,l=t(97458),o=t(83849),a=t.n(o),r=t(90292),i=t.n(r),c=t(52983),d=t(97515),u=t(37091),m=t(62361);!function(e){e.LEFT="left",e.RIGHT="right"}(s||(s={}));const x=e=>{let{children:n,description:t,descriptionColor:s,destructiveAction:o,href:r,icon:i,label:d,labelClasses:m,noSelection:x,onClick:h,rightControl:v,selected:p,selectionSide:f="right",tag:C="a",wrapperCssClasses:b="flex text-gray-600 hover:bg-gray-50 hover:text-gray-600 transition-colors rounded-md items-center px-2 font-lf-regular"}=e;const y=(0,c.useMemo)((()=>"left"===f?(0,l.jsxs)("div",{className:"flex items-center justify-start w-full space-x-2 text-sm cursor-pointer",children:[!x&&(0,l.jsx)("div",{className:"flex items-center w-5",children:(0,l.jsx)(u.J,{name:"tick",color:"text-gray-600",small:!0,className:a()({"opacity-0":!p})})}),(0,l.jsx)("div",{className:"flex items-center w-full h-8 space-x-2",children:n||(0,l.jsxs)(l.Fragment,{children:[i,(0,l.jsx)("div",{className:"text-sm whitespace-nowrap",children:d}),v&&(0,l.jsx)("div",{className:"flex items-center ml-auto",children:v})]})})]}):(0,l.jsxs)("div",{className:"flex items-center w-full h-8 space-x-2 text-sm cursor-pointer",children:[n||(0,l.jsxs)(l.Fragment,{children:[i,(0,l.jsx)("div",{className:"text-sm",children:d})]}),p&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex-grow"}),(0,l.jsx)("div",{className:"flex items-center ml-auto",children:(0,l.jsx)(u.J,{name:"tick",color:"text-gray-600",small:!0})})]}),v&&(0,l.jsx)("div",{className:"flex items-center ml-auto",children:v})]})),[p,v,d,n,i,x,f]),j=c.createElement(C,{className:b+(o?"text-red-500 hover:bg-red-100 hover:text-red-500":""),href:r,onClick:h},(0,l.jsx)(l.Fragment,{children:t?(0,l.jsxs)("div",{className:"flex flex-col w-full py-2 text-sm cursor-pointer",children:[(0,l.jsxs)("div",{className:"".concat(m||""," flex items-center w-full space-x-2"),children:[(0,l.jsx)("div",{className:"text-sm",children:d}),p&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"flex-grow"}),(0,l.jsx)("div",{className:"flex items-center ml-auto",children:(0,l.jsx)(u.J,{name:"tick",color:"text-gray-600",small:!0})})]})]}),(0,l.jsx)("p",{className:"".concat(s||"text-gray-900"),children:t})]}):y}));return(0,l.jsx)("div",{children:j})},h=e=>e&&e.value&&"string"==typeof e.value,v=(0,c.forwardRef)(((e,n)=>{let{button:t,buttonType:s="SelectorType",interaction:o="click",noPadding:r=!1,multiSelection:v=[],onChange:p,onMultiselectChange:f,options:C,placement:b="top",selection:y,staticButton:j=!1,width:g="w-48",wrapperCssClasses:k,selectionSide:w="right"}=e;const[N,I]=(0,c.useState)(y),[R,M]=(0,c.useState)(v),[S,E]=(0,c.useState)(!1),A=(0,c.useMemo)((()=>"dropdown-selector-".concat(Math.round(1e3*Math.random()))),[]);(0,c.useEffect)((()=>{S&&E(!1)}),[S]),(0,c.useEffect)((()=>{I(y)}),[y]);const F=(0,c.useMemo)((()=>C.reduce(((e,n)=>(n.multiSelect?e.nonMutuallyExclusiveOptions.push(n):e.mutuallyExclusiveOptions.push(n),e)),{mutuallyExclusiveOptions:[],nonMutuallyExclusiveOptions:[]})),[C]);(0,c.useImperativeHandle)(n,(()=>({close(){E(!0)},open(){E(!1)}})),[]);const D=e=>{e.stateless||I(e),p&&p(e)},U=(e,n)=>{M((t=>{if(!t)return t;if(n)t.push(e);else{const n=t.findIndex((n=>n.label===e.label));-1!==n&&t.splice(n,1)}return i()(t)})),null==f||f(e,n)},T=F.nonMutuallyExclusiveOptions.map(((e,n)=>{const t="".concat(A,"-key-nme-").concat(n),s=Boolean(R&&R.find((n=>n.label===e.label)));return c.isValidElement(e.element)?(0,l.jsx)(x,{label:e.label,icon:e.icon,onClick:()=>{U(e,!s),E(!0)},selected:s,description:e.description,labelClasses:e.labelClasses,descriptionColor:e.descriptionColor,destructiveAction:e.destructiveAction,selectionSide:w,children:e.element},t):(0,l.jsx)(x,{label:e.label,icon:e.icon,onClick:()=>{U(e,!s),E(!0)},selected:s,description:e.description,labelClasses:e.labelClasses,descriptionColor:e.descriptionColor,destructiveAction:e.destructiveAction,selectionSide:w},t)})),L=F.mutuallyExclusiveOptions.map(((e,n)=>{const t="".concat(A,"-key-me-").concat(n),s=(null==N?void 0:N.label)===e.label;return c.isValidElement(e.element)?(0,l.jsx)(x,{label:e.label,icon:e.icon,onClick:()=>{D(e),E(!0)},selected:s,description:e.description,labelClasses:"".concat(e.labelClasses,"w-full"),descriptionColor:e.descriptionColor,destructiveAction:e.destructiveAction,selectionSide:w,children:e.element},t):(0,l.jsx)(x,{label:e.label,icon:e.icon,onClick:()=>{D(e),E(!0)},selected:s,description:e.description,labelClasses:e.labelClasses,descriptionColor:e.descriptionColor,destructiveAction:e.destructiveAction,selectionSide:w},t)})),P=(0,c.useMemo)((()=>j?t||(0,l.jsx)("div",{}):N?"MenuType"===s?(0,l.jsx)(m.Xi,{icon:N.icon,rightControl:(0,l.jsx)(u.J,{name:"chevron-right",color:"text-gray-500"}),label:N.label}):(0,l.jsx)(x,{wrapperCssClasses:a()("flex text-gray-600 hover:bg-gray-50 hover:text-gray-600 transition-colors rounded-md h-8 items-center font-lf-regular",{"px-4":!r}),label:N.label,icon:N.icon,noSelection:!0,rightControl:(0,l.jsx)("div",{className:"text-gray-500",children:(0,l.jsx)(u.J,{name:"chevron-down-fill",small:!0})})}):h(t)?"MenuType"===s?(0,l.jsx)(m.Xi,{icon:t.icon,rightControl:(0,l.jsx)(u.J,{name:"chevron-right",color:"text-gray-500"}),label:t.label}):(0,l.jsx)(x,{noSelection:!0,wrapperCssClasses:a()("flex text-gray-900 hover:bg-gray-50 hover:text-gray-900 transition-colors rounded-md h-8 items-center font-lf-regular",{"px-4":!r}),label:t.label,icon:t.icon,rightControl:(0,l.jsx)("div",{className:"text-gray-500",children:(0,l.jsx)(u.J,{name:"chevron-down-fill",small:!0})})}):t||(0,l.jsx)("div",{})),[t,s,N,r,j]),V=(0,c.useMemo)((()=>(0,l.jsxs)("div",{className:"bg-white border border-gray-100 shadow-md rounded-md outline-none ".concat(g),children:[(0,l.jsx)("div",{className:"p-2 px-1",children:L}),T.length>0&&(0,l.jsx)("div",{className:"p-2 px-1 border-t border-gray-100",children:T})]})),[g,L,T]),{containerRef:B}=(0,d.x)();return(0,l.jsx)(d.L,{container:null==B?void 0:B.current,wrapperCssClasses:k,placement:b,button:P,forceClose:S,interaction:o,menu:V})}));v.displayName="DropdownSelector"},35463:function(e,n,t){t.d(n,{n:function(){return c}});var s=t(97458),l=t(83849),o=t.n(l),a=t(52983),r=t(10103),i=t(23048);const c=(0,a.forwardRef)(((e,n)=>{let{compact:t=!1,disabled:l,hoverBackgroundColorClass:c,hoverIconColorClass:d,icon:u,iconColorClass:m,onClick:x,placement:h="left",shortcut:v,title:p}=e;const f=(0,a.useCallback)((()=>{x&&x()}),[x]);return(0,s.jsx)(i.u,{title:p,placement:h,shortcut:v,children:(0,s.jsx)(r.h,{medium:t,ref:n,name:u,onClick:f,rounded:!0,backgroundColor:"white",iconClass:m,noFocus:!0,hoverBackgroundClass:o()(c||"hover:bg-gray-100","!size-8 !rounded-lg"),hoverIconClass:d||"",darker:!0,disabled:l})})}));c.displayName="FloatingControl"},67522:function(e,n,t){t.d(n,{OL:function(){return h},UR:function(){return m},VP:function(){return u},X0:function(){return c},_i:function(){return x},es:function(){return i},us:function(){return d}});var s=t(88360),l=t(52983),o=t(80794),a=t(88383),r=t(16887);const i=e=>{let{entityGroupId:n,entityId:t="",isEnabled:i,workspaceId:c}=e;const[,d]=(0,o.Db)(a.lC),u=(0,l.useCallback)((async e=>{let{coordinates:l,frame:o,name:a,...u}=e;var m,x;if(!i)return;const h=u.body.trim(),v={};let p=s.td.General;if("number"==typeof o&&(v.frame=o,v.type=l?r.CX.Annotation:r.CX.Keyframe,p=l?s.td.Annotated:s.td.Keyframe,l)){const e={};e.type=r.TL.Point,e.x=l.x,e.y=l.y,l.ratio&&(e.ratio=[l.ratio.x,l.ratio.y]),v.annotation=e}const f=null===(m=(await d({input:{entityId:t,type:r.TY.FileVersion,body:h,name:a,extra:"number"==typeof o?v:null}})).data)||void 0===m?void 0:m.commentCreate;(0,s.Z9)(new s.qq({commentId:null==f?void 0:f.id,commentMentionIncluded:Boolean(null==f||null===(x=f.mentions)||void 0===x?void 0:x.length),commentType:p,commentSubType:s.pl.NewComment,fileId:n,fileVersionId:t,workspaceId:c}))}),[n,t,c,d]);return u},c=e=>{let{entityGroupId:n,entityId:t="",isEnabled:r,workspaceId:i}=e;const[,c]=(0,o.Db)(a.Di);return(0,l.useCallback)((async e=>{r&&(await c({id:e}),(0,s.Z9)(new s.AG({commentId:e,fileId:n,fileVersionId:t,workspaceId:i})))}),[t,n,i,c])},d=e=>{let{entityGroupId:n,entityId:t="",isEnabled:i,workspaceId:c}=e;const[,d]=(0,o.Db)(a.rZ);return(0,l.useCallback)((async(e,l)=>{var o,a;if(!i)return;const u=l.trim(),m=null===(o=(await d({id:e,body:u})).data)||void 0===o?void 0:o.commentEdit;let x=s.td.General;m.extra&&(x=m.extra.type===r.CX.Annotation?s.td.Annotated:s.td.Keyframe),(0,s.Z9)(new s.bm({commentId:e,commentType:x,commentMentionIncluded:Boolean(null==m||null===(a=m.mentions)||void 0===a?void 0:a.length),commentSubType:s.pl.EditComment,fileId:n,fileVersionId:t,workspaceId:c}))}),[t,n,c,d])},u=e=>{let{entityGroupId:n,entityId:t="",isEnabled:r,workspaceId:i}=e;const[,c]=(0,o.Db)(a.Lq);return(0,l.useCallback)((async(e,l,o)=>{var a;if(!r)return;const d=l.trim(),u=(await c({id:e,body:d,name:o})).data.commentReplyCreate;(0,s.Z9)(new s.qq({parentId:e,commentId:u.id,commentType:s.td.Reply,commentSubType:s.pl.ReplyComment,commentMentionIncluded:Boolean(null===(a=u.mentions)||void 0===a?void 0:a.length),fileId:n,fileVersionId:t,workspaceId:i}))}),[n,t,i,c])},m=e=>{let{entityGroupId:n,entityId:t="",isEnabled:r,workspaceId:i}=e;const[,c]=(0,o.Db)(a.WS);return(0,l.useCallback)((async e=>{r&&(await c({id:e}),(0,s.Z9)(new s.rP({commentId:e,fileId:n,fileVersionId:t,workspaceId:i})))}),[n,t,i,c])},x=e=>{let{entityGroupId:n,entityId:t="",isEnabled:r,workspaceId:i}=e;const[,c]=(0,o.Db)(a.dC);return(0,l.useCallback)((async e=>{r&&(await c({id:e}),(0,s.Z9)(new s.ci({commentId:e,fileId:n,fileVersionId:t,workspaceId:i})))}),[t,n,i,c])},h=e=>{let{entityGroupId:n,entityId:t="",isEnabled:r,workspaceId:i}=e;const[,c]=(0,o.Db)(a.ns),[,d]=(0,o.Db)(a.PS),u=(0,l.useCallback)((function(e,l){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r&&(o?(d({id:e,type:l}),(0,s.Z9)(new s.RD({commentId:e,reactionType:l,fileId:n,fileVersionId:t,workspaceId:i}))):(c({id:e,type:l}),(0,s.Z9)(new s.Gf({commentId:e,reactionType:l,fileId:n,fileVersionId:t,workspaceId:i}))))}),[r,t,n,i,c,d]);return u}},26531:function(e,n,t){t.d(n,{M:function(){return c}});var s=t(52983),l=t(80794),o=t(70017),a=t(67496),r=t(88383),i=t(49146);const c=e=>{let{entityId:n,entityType:t}=e;var c,d;const[u,m]=(0,s.useState)(null),[x,h]=(0,s.useState)(a.CommentPushoverMode.DiscussionMode),[v,p]=(0,s.useState)(!1),f=(0,l.m8)(),[C]=(0,l.aM)({query:r.wR,variables:{id:n,type:t,first:12},pause:!n}),b=(0,s.useMemo)((()=>{var e,n;return null===u?null:(null===(n=C.data)||void 0===n||null===(e=n.comments.edges.find((e=>e.node.id===u)))||void 0===e?void 0:e.node)||null}),[u,null===(c=C.data)||void 0===c?void 0:c.comments.edges]),y=(0,s.useCallback)((e=>{m((null==e?void 0:e.id)||null),h(e?a.CommentPushoverMode.ReplyMode:a.CommentPushoverMode.DiscussionMode)}),[]),j=(0,s.useCallback)((()=>{m(null),h(a.CommentPushoverMode.DiscussionMode)}),[]),g=(0,s.useCallback)((async()=>{var e;if(!n||!t)return;const s=(null===(e=C.data)||void 0===e?void 0:e.comments.edges)||[],l=[],o=async e=>{if(e)try{await f.query(r.wR,{id:n,type:t,first:12,after:e.cursor},{requestPolicy:"network-only"}).toPromise(),await(0,i._v)(1e3)}catch(e){}};for(let e=0;e<s.length;e+=1)e&&e%11==0&&l.push(o(s[e]));await Promise.all(l)}),[n,t,null===(d=C.data)||void 0===d?void 0:d.comments.edges]),k=(0,s.useCallback)((async()=>{var e,s;if(C.data&&!C.fetching&&(null===(e=C.data.comments.pageInfo)||void 0===e?void 0:e.hasNextPage)&&(null===(s=C.data.comments.pageInfo)||void 0===s?void 0:s.endCursor))try{await f.query(r.wR,{id:n,type:t,after:C.data.comments.pageInfo.endCursor,first:12}).toPromise()}finally{}}),[f,C.data,C.fetching,n,t]);(0,s.useEffect)((()=>{const e=()=>{p(Boolean(document.hidden))};return document.addEventListener("visibilitychange",e,!1),()=>{document.removeEventListener("visibilitychange",e,!1)}}),[]),(0,o.Y)({task:g,pause:!n||v});const w=(0,s.useMemo)((()=>{var e,n;return{canFetchMoreComments:(null===(n=C.data)||void 0===n||null===(e=n.comments.pageInfo)||void 0===e?void 0:e.hasNextPage)||!1,commentsQuery:C,onFetchMoreComments:k,onHideReplies:j,onShowReplies:y,parentComment:b,pushoverMode:x}}),[C,C.data,k,j,y,b,x]);return w}}}]);